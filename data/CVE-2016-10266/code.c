#include <stdio.h>
#include <stdint.h>
#include <assert.h>

/**
 * Calculate the number of units of size 'unit_size' needed to contain 'total_size' items,
 * rounding up to the next whole unit if there's a remainder.
 *
 * @param total_size The total number of items.
 * @param unit_size The size of each unit.
 * @return The number of units needed.
 */
uint32_t calculate_units_needed(uint32_t total_size, uint32_t unit_size) {
// BEGIN SOLUTION
    return (total_size / unit_size) + ((total_size % unit_size) != 0);
// END SOLUTION
}

/* Key structure definitions */

/**
 * Structure to represent a TIFF header.
 */
typedef struct {
    uint16_t magic_number;    /* Magic number to identify TIFF files */
    uint16_t version;         /* TIFF version number */
    uint32_t dir_offset;      /* Offset to the first directory */
} TIFFHeader;

/**
 * Structure to represent a TIFF directory.
 */
typedef struct {
    uint16_t num_entries;     /* Number of directory entries */
    uint32_t next_dir_offset; /* Offset to the next directory */
    uint32_t image_length;    /* Total length of the image in rows */
    uint32_t rows_per_strip;  /* Number of rows per strip */
} TIFFDirectory;

/* Function definitions */

/**
 * Initialize a TIFF header with default values.
 *
 * @param header Pointer to the TIFF header structure.
 */
void initialize_tiff_header(TIFFHeader* header) {
    header->magic_number = 0x4D4D;  /* Example magic number */
    header->version = 42;           /* Example version number */
    header->dir_offset = 8;         /* Example directory offset */
}

/**
 * Read a TIFF directory from a file.
 *
 * @param file Pointer to the file object.
 * @param dir Pointer to the TIFF directory structure.
 * @return 1 on success, 0 on failure.
 */
int read_tiff_directory(FILE* file, TIFFDirectory* dir) {
    if (fread(&dir->num_entries, sizeof(uint16_t), 1, file) != 1) {
        return 0;
    }
    if (fread(&dir->next_dir_offset, sizeof(uint32_t), 1, file) != 1) {
        return 0;
    }
    if (fread(&dir->image_length, sizeof(uint32_t), 1, file) != 1) {
        return 0;
    }
    if (fread(&dir->rows_per_strip, sizeof(uint32_t), 1, file) != 1) {
        return 0;
    }
    return 1;
}

/**
 * Get the size of a strip to be read from the file.
 *
 * @param file Pointer to the file object.
 * @param dir Pointer to the TIFF directory structure.
 * @return The size of the strip, or 0 on failure.
 */
uint32_t get_strip_size(FILE* file, TIFFDirectory* dir) {
    /* Read the TIFF directory */
    if (!read_tiff_directory(file, dir)) {
        fprintf(stderr, "Failed to read TIFF directory\n");
        return 0;
    }

    /* Calculate the number of strips needed */
    
    assert(dir->rows_per_strip != 0);
    return calculate_units_needed(dir->image_length, dir->rows_per_strip);
}